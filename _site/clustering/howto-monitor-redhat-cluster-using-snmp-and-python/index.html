<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>HowTo monitor RedHat Cluster using snmp and python &#8211; Linuxdynasty</title>
<meta name="description" content="Scripting, Programing, Automation, Integration, Monitoring, and Projects...">
<meta name="keywords" content="RedHat Clustering, HowTo monitor RedHat Cluster using snmp and python">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://linuxdynasty.github.io/Linuxdynasty/images/">
<meta name="twitter:title" content="HowTo monitor RedHat Cluster using snmp and python">
<meta name="twitter:description" content="Scripting, Programing, Automation, Integration, Monitoring, and Projects...">
<meta name="twitter:creator" content="@linuxdynasty">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="HowTo monitor RedHat Cluster using snmp and python">
<meta property="og:description" content="Scripting, Programing, Automation, Integration, Monitoring, and Projects...">
<meta property="og:url" content="http://linuxdynasty.github.io/Linuxdynasty/clustering/howto-monitor-redhat-cluster-using-snmp-and-python/">
<meta property="og:site_name" content="Linuxdynasty">





<link rel="canonical" href="http://linuxdynasty.github.io/Linuxdynasty/clustering/howto-monitor-redhat-cluster-using-snmp-and-python/">
<link href="http://linuxdynasty.github.io/Linuxdynasty/feed.xml" type="application/atom+xml" rel="alternate" title="Linuxdynasty Feed">
<link rel="author" href="https://google.com/+AllenSanabria?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://linuxdynasty.github.io/Linuxdynasty/assets/css/main.min.css">
<!-- Webfonts -->
<link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://linuxdynasty.github.io/Linuxdynasty/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://linuxdynasty.github.io/Linuxdynasty/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://linuxdynasty.github.io/Linuxdynasty/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://linuxdynasty.github.io/Linuxdynasty/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://linuxdynasty.github.io/Linuxdynasty/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://linuxdynasty.github.io/Linuxdynasty/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://linuxdynasty.github.io/Linuxdynasty/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://linuxdynasty.github.io/Linuxdynasty">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://linuxdynasty.github.io/Linuxdynasty/images/avatar.jpg" alt="Allen Sanabria photo" class="author-photo">
					<h4>Allen Sanabria</h4>
					<p>DevOps developer who loves programming, monitoring, automation, and metrics.</p>
				</li>
				<li><a href="http://linuxdynasty.github.io/Linuxdynasty/about/">Learn More</a></li>
				<li>
					<a href="mailto:asanabria <@> linuxdynasty dot org"><i class="fa fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="http://twitter.com/linuxdynasty"><i class="fa fa-twitter"></i> Twitter</a>
				</li>
				
				<li>
					<a href="https://google.com/+AllenSanabria"><i class="fa fa-google-plus"></i> Google+</a>
				</li>
				<li>
					<a href="http://linkedin.com/in/linuxdynasty"><i class="fa fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="http://github.com/linuxdynasty"><i class="fa fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="http://linuxdynasty.github.io/Linuxdynasty/posts/">All Posts</a></li>
				<li><a href="http://linuxdynasty.github.io/Linuxdynasty/tags/">All Tags</a></li>
			</ul>
		</li>
		<li><a href="http://linuxdynasty.github.io/Linuxdynasty"></a></li><li><a href="http://linuxdynasty.github.io/Linuxdynasty"></a></li>
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->




<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="http://linuxdynasty.github.io/Linuxdynasty/clustering/howto-monitor-redhat-cluster-using-snmp-and-python/" rel="bookmark" title="HowTo monitor RedHat Cluster using snmp and python">HowTo monitor RedHat Cluster using snmp and python</a></h1>
        
        <h2>August 28, 2009</h2>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~5 minutes
        </p><!-- /.entry-reading-time -->
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>Now that I am done with the implementation of RHE Cluster with GFS2, I now need to setup monitoring. As you all know, monitoring is a vital part of any environment. Even though we have a cluster of nodes setup, we still need to be aware of what is happening. Currently here are 2 very important tools, for checking the cluster status.</p>
<p><span style="color: #0000ff;"><strong>clustat</strong> </span> ( which is installed by the rgmanager rpm ) The clustat command will give you a quick status about all the nodes in the cluster and of the services running.<br />
<span style="color: #0000ff;"><strong>cman_tool</strong></span> ( which is installed by the cman rpm ) The cman_tool command is for managing a node in the cluster ( leaving, joining, votes, and status ).</p>
<p>Here is an example of <span style="color: #0000ff;"><strong>clustat</strong></span>...</p>
<pre><code>clustat Cluster Status for MyCluster @ Sat Aug 29 18:37:27 2009Member Status: Quorate Member Name ID Status ------ ---- ---- ------ gfs1 1 Online, Local, rgmanager gfs2 2 Online, rgmanager gfs3 3 Online, rgmanager /dev/disk/by-path/pci-0000:00:11.0-scsi-0:0:1:0-part1 0 Online, Quorum Disk Service Name Owner (Last) State ------- ---- ----- ------ ----- service:CIM gfs1 started service:Pirahna (gfs2) disabled</code></pre>
<p>&nbsp;</p>
<p><a id="more"></a><a id="more-218"></a></p>
<p>Here is an example of the <span style="color: #0000ff;"><strong>cman_tool</strong></span> command...</p>
<pre>cman_tool statusVersion: 6.1.0Config Version: 39Cluster Name: MyClusterCluster Id: 46516Cluster Member: YesCluster Generation: 392Membership state: Cluster-MemberNodes: 3Expected votes: 5Quorum device votes: 2Total votes: 5Quorum: 3  Active subsystems: 10Flags: Dirty Ports Bound: 0 11 177  Node name: gfs1Node ID: 1Multicast addresses: 239.192.181.106 Node addresses: 192.168.101.100</pre>
<p>As you noticed above, the information you get from both commands are extremely useful. The issue is that if you want the information from <span style="color: #0000ff;"><strong>clustat</strong></span> or <span style="color: #0000ff;"><strong>cman_tool</strong></span>, you will have to run those commands on a node that is part of the cluster. The reason this is an issue to me, is because I do not want to be burdened with sshing into one of the nodes anytime I want to know the status of the cluster. I want to be able to get that info directly from my desktop or from my monitoring system. After some research I discovered that there is a package called cluster-snmp that is part fo the yum "Clustering" Group.</p>
<p>This was exactly what I was looking for! A way to monitor or check the status of my cluster with out ssh. The next step is to configure cluster-snmp so that we can use it..<br />
<span class="note">NOTE... please do the following commands on all the nodes in your cluster...</span></p>
<ol>
<li>yum install cluster-snmp</li>
<li>vi /etc/snmp/snmpd.conf<br />
If your nodes are 32bit, add this into the file
<pre class="jive-pre"><code class="jive-code">dlmod RedHatCluster /usr/lib/cluster-snmp/libClusterMonitorSnmp.soview systemview included REDHAT-CLUSTER-MIB:RedHatCluster</code></pre>
<p>Or if your nodes are 64bit, add this into the file</p>
<pre class="jive-pre"><code class="jive-code">dlmod RedHatCluster /usr/lib64/cluster-snmp/libClusterMonitorSnmp.soview systemview included REDHAT-CLUSTER-MIB:RedHatCluster</code></pre>
</li>
<li>restart snmpd ( service snmpd restart )</li>
<li>Now do a snmpwalk... Example below..
<pre>snmpwalk -v2c -c public  localhost REDHAT-CLUSTER-MIB::RedHatCluster</pre>
<pre>REDHAT-CLUSTER-MIB::rhcMIBVersion.0 = INTEGER: 1REDHAT-CLUSTER-MIB::rhcClusterName.0 = STRING: "MyCluster"REDHAT-CLUSTER-MIB::rhcClusterStatusCode.0 = INTEGER: 4REDHAT-CLUSTER-MIB::rhcClusterStatusDesc.0 = STRING: "Some services not running"REDHAT-CLUSTER-MIB::rhcClusterVotesNeededForQuorum.0 = INTEGER: 3REDHAT-CLUSTER-MIB::rhcClusterVotes.0 = INTEGER: 5REDHAT-CLUSTER-MIB::rhcClusterQuorate.0 = INTEGER: 1REDHAT-CLUSTER-MIB::rhcClusterNodesNum.0 = INTEGER: 3REDHAT-CLUSTER-MIB::rhcClusterNodesNames.0 = STRING: "gfs1, gfs2, gfs3"REDHAT-CLUSTER-MIB::rhcClusterAvailNodesNum.0 = INTEGER: 3REDHAT-CLUSTER-MIB::rhcClusterAvailNodesNames.0 = STRING: "gfs1, gfs2, gfs3"REDHAT-CLUSTER-MIB::rhcClusterUnavailNodesNum.0 = INTEGER: 0REDHAT-CLUSTER-MIB::rhcClusterUnavailNodesNames.0 = ""REDHAT-CLUSTER-MIB::rhcClusterServicesNum.0 = INTEGER: 2REDHAT-CLUSTER-MIB::rhcClusterServicesNames.0 = STRING: "Pirahna, CIM"REDHAT-CLUSTER-MIB::rhcClusterRunningServicesNum.0 = INTEGER: 1REDHAT-CLUSTER-MIB::rhcClusterRunningServicesNames.0 = STRING: "CIM"REDHAT-CLUSTER-MIB::rhcClusterStoppedServicesNum.0 = INTEGER: 1REDHAT-CLUSTER-MIB::rhcClusterStoppedServicesNames.0 = STRING: "Pirahna"REDHAT-CLUSTER-MIB::rhcClusterFailedServicesNum.0 = INTEGER: 0REDHAT-CLUSTER-MIB::rhcClusterFailedServicesNames.0 = ""REDHAT-CLUSTER-MIB::rhcNodeName."gfs1" = STRING: "gfs1"REDHAT-CLUSTER-MIB::rhcNodeName."gfs2" = STRING: "gfs2"REDHAT-CLUSTER-MIB::rhcNodeName."gfs3" = STRING: "gfs3"REDHAT-CLUSTER-MIB::rhcNodeStatusCode."gfs1" = INTEGER: 0REDHAT-CLUSTER-MIB::rhcNodeStatusCode."gfs2" = INTEGER: 0REDHAT-CLUSTER-MIB::rhcNodeStatusCode."gfs3" = INTEGER: 0REDHAT-CLUSTER-MIB::rhcNodeStatusDesc."gfs1" = STRING: "Participating in cluster"REDHAT-CLUSTER-MIB::rhcNodeStatusDesc."gfs2" = STRING: "Participating in cluster"REDHAT-CLUSTER-MIB::rhcNodeStatusDesc."gfs3" = STRING: "Participating in cluster"REDHAT-CLUSTER-MIB::rhcNodeRunningServicesNum."gfs1" = INTEGER: 1REDHAT-CLUSTER-MIB::rhcNodeRunningServicesNum."gfs2" = INTEGER: 0REDHAT-CLUSTER-MIB::rhcNodeRunningServicesNum."gfs3" = INTEGER: 0REDHAT-CLUSTER-MIB::rhcNodeRunningServicesNames."gfs1" = STRING: "CIM"REDHAT-CLUSTER-MIB::rhcNodeRunningServicesNames."gfs2" = ""REDHAT-CLUSTER-MIB::rhcNodeRunningServicesNames."gfs3" = ""REDHAT-CLUSTER-MIB::rhcServiceName."CIM" = STRING: "CIM"REDHAT-CLUSTER-MIB::rhcServiceName."Pirahna" = STRING: "Pirahna"REDHAT-CLUSTER-MIB::rhcServiceStatusCode."CIM" = INTEGER: 0REDHAT-CLUSTER-MIB::rhcServiceStatusCode."Pirahna" = INTEGER: 1REDHAT-CLUSTER-MIB::rhcServiceStatusDesc."CIM" = STRING: "running"REDHAT-CLUSTER-MIB::rhcServiceStatusDesc."Pirahna" = STRING: "stopped"REDHAT-CLUSTER-MIB::rhcServiceStartMode."CIM" = STRING: "automatic"REDHAT-CLUSTER-MIB::rhcServiceStartMode."Pirahna" = STRING: "automatic"REDHAT-CLUSTER-MIB::rhcServiceRunningOnNode."CIM" = STRING: "gfs1"</pre>
</li>
</ol>
<p>As you can see you get a wealth of information from SNMP, though it is not all the information you need, but it has about 90% of what is important... So I decided to massage the data I get from snmp and create my own <a href="View-details/LinuxDynasty/45-clustat_snmp.py.html"><span style="color: #0000ff;"><strong>clustat_snmp.py</strong></span></a> command and my own <span style="color: #0000ff;"><strong><a href="View-details/Clustering-Tools/46-rh_cluster_check.py.html">rhe_cluster_check.py</a> </strong></span>. One command is to behave some what like the clustat utility and the other command is to check the status of your cluster through snmp, for monitoring systems like Nagios and Zenoss.</p>
<p>clustat_snmp.py =={filelink=17}<br />
Here is an example of the output you will get from<a href="View-details/LinuxDynasty/45-clustat_snmp.py.html"><span style="color: #0000ff;"><strong> clustat_snmp.py</strong></span>..</a></p>
<p><small>clustat_snmp.py -d gfs1 -c publicCluster Status for MyCluster @ Fri Aug 28 11:59:40 2009Member Status: QuorateTotal Nodes: 3Total Votes: 5Votes Needed For Quorum: 3</small><small> Member Name Status ------ ---- ------ gfs1 Participating in cluster gfs2 Participating in cluster gfs3 Participating in cluster Service Name Owner State Start Up Mode ------- ---- ----- ----- ------------- Pirahna stopped automatic CIM gfs1 running automatic</small></p>
<p>As you can see above, you get some of what the <span style="color: #0000ff;"><strong>clustat</strong></span> command gives you and some of what the <span style="color: #0000ff;"><strong>cman_tool status</strong></span> command gives you. But you get it all in one command through Python and Snmp. For both Python scripts you will need the two python modules. which are pysnmp and pyasn1.<br />
To make your life easier you should do the following...</p>
<ol>
<li>install <a title="title" href="http://pypi.python.org/pypi/setuptools">python-setuptools<br />
</a></li>
<li>then run easy_install pysnmp</li>
<li>and easy_install pyasn1</li>
<li>or you can download the 2 modules manually.<br />
<a title="title" href="http://voxel.dl.sourceforge.net/sourceforge/pysnmp/pysnmp-4.1.10a.tar.gz">pysnmp</a> and <a title="title" href="http://voxel.dl.sourceforge.net/sourceforge/pyasn1/pyasn1-0.0.8a.tar.gz">pyasn1</a></li>
<li>then unzip the 2 files and in each directory run <strong>python setup.py install</strong></li>
</ol>
<p>I am using the following revisions from the python cheese shop pysnmp 4.1.7a and pyasn1 0.0.6</p>
<p>The next command is the Nagios/Zenoss compatible <span style="color: #0000ff;"><strong>rh_cluster_check.py.</strong></span>..<br />
{filelink=18}<br />
Here is an example of the output you will get from rh_cluster_check.py..</p>
<pre>     python rh_cluster_check.py -d gfs1 -c public -t node -n gfs3      OK, gfs3 is Participating in cluster</pre>
<pre>      python rh_cluster_check.py -d gfs1 -c public -t service -s CIM      OK, CIM is running on gfs1</pre>
<pre>      python rh_cluster_check.py -d gfs2 -c public -t cluster      WARNING, MyCluster is Quorate and Some services not running

      python rh_cluster_check.py -d gfs1 -c public -t service -s Pirahna      CRITICAL, Pirahna is stopped</pre>
<p>The above command will allow you to check your cluster information by the means of pysnmp. You can check on the status of a particular node, the status of the cluster, and the status of a service.</p>
<p>&nbsp;</p>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="http://linuxdynasty.github.io/Linuxdynasty/tags/#RedHat Clustering" title="Pages tagged RedHat Clustering" class="tag">RedHat Clustering</a><a href="http://linuxdynasty.github.io/Linuxdynasty/tags/#HowTo monitor RedHat Cluster using snmp and python" title="Pages tagged HowTo monitor RedHat Cluster using snmp and python" class="tag">HowTo monitor RedHat Cluster using snmp and python</a></span>
        <span><a href="http://linuxdynasty.github.io/Linuxdynasty/clustering/howto-monitor-redhat-cluster-using-snmp-and-python/" rel="bookmark" title="HowTo monitor RedHat Cluster using snmp and python">HowTo monitor RedHat Cluster using snmp and python</a> was published on <span class="entry-date date published updated"><time datetime="2009-08-28T15:05:51-04:00">August 28, 2009</time></span></span>
        
        <span class="author vcard"><span class="fn"><a href="http://linuxdynasty.github.io/Linuxdynasty/about/" title="About Allen Sanabria">Allen Sanabria</a></span></span>
        
      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    
    <div class="read-more">
      
        <div class="read-more-header">
          <a href="http://linuxdynasty.github.io/Linuxdynasty/clustering/howto-setup-a-quorum-disk/" class="read-more-btn">Read More</a>
        </div><!-- /.read-more-header -->
        <div class="read-more-content">
          <h3><a href="http://linuxdynasty.github.io/Linuxdynasty/graph-resque-metrics-using-sensu-and-graphite/" title="Graph resque metrics using sensu and graphite.">Graph resque metrics using sensu and graphite.</a></h3>
          <p>We are using Resque for our background jobs and we use the Resque Web interfaceto keep track of what is happening. But the only issue, is...&hellip; <a href="http://linuxdynasty.github.io/Linuxdynasty/graph-resque-metrics-using-sensu-and-graphite/">Continue reading</a></p>
        </div><!-- /.read-more-content -->
      
      <div class="read-more-list">
        
          <div class="list-item">
            <h4><a href="http://linuxdynasty.github.io/Linuxdynasty/graph-passenger-metrics-using-sensu-and-graphite/" title="Graph passenger metrics using sensu and graphite.">Graph passenger metrics using sensu and graphite.</a></h4>
            <span>Published on October 10, 2014</span>
          </div><!-- /.list-item -->
        
          <div class="list-item">
            <h4><a href="http://linuxdynasty.github.io/Linuxdynasty/graph-nginx-status-codes-in-graphite/" title="Graph nginx status codes in Graphite.">Graph nginx status codes in Graphite.</a></h4>
            <span>Published on September 26, 2014</span>
          </div><!-- /.list-item -->
        
      </div><!-- /.read-more-list -->
      
    </div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2014 Allen Sanabria. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://linuxdynasty.github.io/Linuxdynasty/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://linuxdynasty.github.io/Linuxdynasty/assets/js/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2333243-1', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'linuxdynasty'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>	        

</body>
</html>
