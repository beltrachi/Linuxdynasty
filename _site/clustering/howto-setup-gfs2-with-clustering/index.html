<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>HowTo setup GFS2 with Clustering &#8211; Linuxdynasty</title>
<meta name="description" content="Scripting, Programing, Automation, Integration, Monitoring, and Projects...">
<meta name="keywords" content="RedHat Clustering, HowTo setup GFS2 with Clustering, GFS2 Clustering">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://linuxdynasty.github.io/Linuxdynasty/images/">
<meta name="twitter:title" content="HowTo setup GFS2 with Clustering">
<meta name="twitter:description" content="Scripting, Programing, Automation, Integration, Monitoring, and Projects...">
<meta name="twitter:creator" content="@linuxdynasty">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="HowTo setup GFS2 with Clustering">
<meta property="og:description" content="Scripting, Programing, Automation, Integration, Monitoring, and Projects...">
<meta property="og:url" content="http://linuxdynasty.github.io/Linuxdynasty/clustering/howto-setup-gfs2-with-clustering/">
<meta property="og:site_name" content="Linuxdynasty">





<link rel="canonical" href="http://linuxdynasty.github.io/Linuxdynasty/clustering/howto-setup-gfs2-with-clustering/">
<link href="http://linuxdynasty.github.io/Linuxdynasty/feed.xml" type="application/atom+xml" rel="alternate" title="Linuxdynasty Feed">
<link rel="author" href="https://google.com/+AllenSanabria?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://linuxdynasty.github.io/Linuxdynasty/assets/css/main.min.css">
<!-- Webfonts -->
<link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://linuxdynasty.github.io/Linuxdynasty/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://linuxdynasty.github.io/Linuxdynasty/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://linuxdynasty.github.io/Linuxdynasty/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://linuxdynasty.github.io/Linuxdynasty/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://linuxdynasty.github.io/Linuxdynasty/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://linuxdynasty.github.io/Linuxdynasty/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://linuxdynasty.github.io/Linuxdynasty/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://linuxdynasty.github.io/Linuxdynasty">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://linuxdynasty.github.io/Linuxdynasty/images/avatar.jpg" alt="Allen Sanabria photo" class="author-photo">
					<h4>Allen Sanabria</h4>
					<p>DevOps developer who loves programming, monitoring, automation, and metrics.</p>
				</li>
				<li><a href="http://linuxdynasty.github.io/Linuxdynasty/about/">Learn More</a></li>
				<li>
					<a href="mailto:asanabria <@> linuxdynasty dot org"><i class="fa fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="http://twitter.com/linuxdynasty"><i class="fa fa-twitter"></i> Twitter</a>
				</li>
				
				<li>
					<a href="https://google.com/+AllenSanabria"><i class="fa fa-google-plus"></i> Google+</a>
				</li>
				<li>
					<a href="http://linkedin.com/in/linuxdynasty"><i class="fa fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="http://github.com/linuxdynasty"><i class="fa fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="http://linuxdynasty.github.io/Linuxdynasty/posts/">All Posts</a></li>
				<li><a href="http://linuxdynasty.github.io/Linuxdynasty/tags/">All Tags</a></li>
			</ul>
		</li>
		<li><a href="http://linuxdynasty.github.io/Linuxdynasty"></a></li><li><a href="http://linuxdynasty.github.io/Linuxdynasty"></a></li>
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->




<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="http://linuxdynasty.github.io/Linuxdynasty/clustering/howto-setup-gfs2-with-clustering/" rel="bookmark" title="HowTo setup GFS2 with Clustering">HowTo setup GFS2 with Clustering</a></h1>
        
        <h2>August 14, 2009</h2>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~4 minutes
        </p><!-- /.entry-reading-time -->
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>In my last project at work, I had to replace NFS with GFS2 and Clustering. So in this tutorial I will show you how to create a Red Hat or CentOS cluster with GFS2. I will also show you how to optimize GFS2 performance in the next HowTo, because you will quickly notice some loss of performance until you do a little optimization first.I will 1st show you how do build a Cluster with GFS2 on the Command Line and in the next tutorial I will show you how to do the same thing using Conga.</p>
<p>In this tutorial I am using 3 CentOS Virtual Machines running CentOS 5.3 in VMware ESX 3.5. For the GFS2 File System I am using a vmdk built with the thick option, that is shared among all the Virtual Machines. You also can use iscsi or fiber... This option is up to you.</p>
<p><span class="attention">Always make sure your iptables (If you know the port's and protocols for clustering, then add it to iptables ) and selinux is OFF. If not you will run into issues.</span></p>
<p>The 3 machines I am using are called</p>
<ul>
<li>gfs1 == 192.168.101.100</li>
<li>gfs2 == 192.168.101.101</li>
<li>gfs3 == 192.168.101.103</li>
</ul>
<p><a id="more"></a><a id="more-215"></a></p>
<p>Since I'm using VMware ESX for the 3 machines above I will also be using vmware for fencing. The info is below for my test setup</p>
<ul>
<li>ESX Host Name == esxtest<br />
ESX IP Address == 192.168.101.50</li>
<li>ESX user login info below<br />
login == esxuser<br />
password == esxpass</li>
<li>ESX admin login info below<br />
login == root<br />
password == esxpass</li>
</ul>
<p>&nbsp;</p>
<p>The 1st command you need to know for creating and modifying your cluster is the '<strong>ccs_tool</strong>' command.</p>
<p>Below I will show you the necessary steps to create a cluster and then the GFS2 filesystem</p>
<ol>
<li>First step is to install the necessary RPM's..<br />
<strong>yum -y install modcluster rgmanager gfs2 gfs2-utils lvm2-cluster cman</strong></li>
<li>Second step is to create a cluster on gfs1<br />
<strong>ccs_tool create GFStestCluster</strong></li>
<li>Now that the cluster is created, we will now need to add the fencing devices.<br />
( For simplicity you can just use fence_manual for each host.. <strong>ccs_tool addfence -C gfs1_ipmi fence_manual</strong> )<br />
But if you are using VMware ESX like I am you should use fence_vmware like so...<br />
<strong>ccs_tool addfence -C gfs1_vmware fence_vmware ipaddr=esxtest login=esxuser passwd=esxpass vmlogin=root vmpasswd=esxpass port="/vmfs/volumes/49086551-c64fd83c-0401-001e0bcd6848/eagle1/gfs1.vmx"</strong><br />
<strong>ccs_tool addfence -C gfs2_vmware fence_vmware ipaddr=esxtest login=esxuser passwd=esxpass vmlogin=root vmpasswd=esxpass port="vmfs/volumes/49086551-c64fd83c-0401-001e0bcd6848/gfs2/gfs2.vmx"</strong><br />
<strong>ccs_tool addfence -C gfs3_vmware fence_vmware ipaddr=esxtest login=esxuser passwd=esxpass vmlogin=root vmpasswd=esxpass port="/vmfs/volumes/49086551-c64fd83c-0401-001e0bcd6848/gfs3/gfs3.vmx"</strong></li>
<li>Now that we added the Fencing devices, it is time to add the nodes..<br />
<strong>ccs_tool addnode -C gfs1 -n 1 -v 1 -f gfs1_vmware<br />
ccs_tool addnode -C gfs2 -n 2 -v 1 -f gfs2_vmware<br />
ccs_tool addnode -C gfs3 -n 3 -v 1 -f gfs3_vmware</strong></li>
<li>Now we need to copy this configuration over to the other 2 nodes from gfs1 or we can run the exact same commands above on the other 2 nodes..<br />
<strong>scp /etc/cluster/cluster.conf root@gfs2:/etc/cluster/cluster.conf<br />
scp /etc/cluster/cluster.conf root@gfs3:/etc/cluster/cluster.conf</strong></li>
<li>You can verify the config on all 3 nodes by running the following commands below..<br />
<strong>ccs_tool lsnode<br />
ccs_tool lsfence</strong></li>
<li>You are ready to proceed with starting up the following daemons on all the nodes in the cluster, once you either copied over the configs or re ran the same commands above on the other 2 nodes<br />
<strong>/etc/init.d/cman start<br />
/etc/init.d/rgmanager start</strong></li>
<li>You can now check the status of your cluster by running the commands below...<strong><br />
clustat<br />
cman_tool status</strong></li>
<li>If you want to test the vmware fencing you can do so by doing the following..<strong> ( </strong>run the command below on the 1st node and use the 2nd node as the node to be fenced<strong> )<br />
fence_vmware -a esxtest -l esxuser -p esxpass -L root -P esxpass -n "/vmfs/volumes/49086551-c64fd83c-0401-001e0bcd6848/gfs2/gfs2.vmx" -v<br />
</strong></li>
<li>Before we start to create the LVM2 volumes and Proceed to GFS2, we will need to enable clustering in LVM2.<br />
<strong>lvmconf --enable-cluster</strong></li>
<li>Now it is time to create the LVM2 Volumes...<br />
<strong>pvcreate MyTestGFS /dev/sdb<br />
vgcreate -c y mytest_gfs2 /dev/sdb<br />
lvcreate -n MyGFS2test -L 5G mytest_gfs2<br />
/etc/init.d/clvmd start</strong></li>
<li>You should now also start <strong>clvmd</strong> on the other 2 nodes..<strong><br />
</strong></li>
<li>Once the above has been completed, you will now need to create the GFS2 file system.. Example below..<br />
mkfs -t &lt;filesystem&gt; -p &lt;locking mechanism&gt; -t &lt;ClusterName&gt;:&lt;PhysicalVolumeName&gt; -j &lt;JournalsNeeded == amount of nodes in cluster&gt; &lt;location of filesystem&gt;<br />
<strong>mkfs -t gfs2 -p lock_dlm -t MyCluster:MyTestGFS -j 4 /dev/mapper/mytest_gfs2-MyGFS2test</strong></li>
<li>All we need to do on the 3 nodes, is to mount the GFS2 file system.<br />
<strong>mount /dev/mapper/mytest_gfs2-MyGFS2test /mnt/<br />
</strong></li>
<li>Once you mounted your GFS2 file system You can the following commands..<strong><br />
gfs2_tool list<br />
gfs2_tool df </strong></li>
</ol>
<p>Now it is time to wrap it up with some final commands...</p>
<ol>
<li>Now that we have a fully functional cluster and a mountable GFS2 file system, we need to make sure all the necessary daemons start up with the cluster..<br />
<strong>chkconfig --level 345 rgmanager on<br />
chkconfig --level 345 clvmd on<br />
chkconfig --level 345 cman on<br />
chkconfig --level 345 gfs2 on</strong></li>
<li>If you want the GFS2 file system to be mounted at startup you can add this to /etc/fstab..<br />
<strong>echo "/dev/mapper/mytest_gfs2-MyGFS2test /GFS gfs2 defaults,noatime,nodiratime 0 0" &gt;&gt; /etc/fstab</strong></li>
</ol>
<p>In the next up coming tutorials I will show you how to do the same as above but with the Red Hat Conga gui and I will also show you how to optimize your GFS2 Cluster setup.</p>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="http://linuxdynasty.github.io/Linuxdynasty/tags/#RedHat Clustering" title="Pages tagged RedHat Clustering" class="tag">RedHat Clustering</a><a href="http://linuxdynasty.github.io/Linuxdynasty/tags/#HowTo setup GFS2 with Clustering" title="Pages tagged HowTo setup GFS2 with Clustering" class="tag">HowTo setup GFS2 with Clustering</a><a href="http://linuxdynasty.github.io/Linuxdynasty/tags/#GFS2 Clustering" title="Pages tagged GFS2 Clustering" class="tag">GFS2 Clustering</a></span>
        <span><a href="http://linuxdynasty.github.io/Linuxdynasty/clustering/howto-setup-gfs2-with-clustering/" rel="bookmark" title="HowTo setup GFS2 with Clustering">HowTo setup GFS2 with Clustering</a> was published on <span class="entry-date date published updated"><time datetime="2009-08-14T16:48:49-04:00">August 14, 2009</time></span></span>
        
        <span class="author vcard"><span class="fn"><a href="http://linuxdynasty.github.io/Linuxdynasty/about/" title="About Allen Sanabria">Allen Sanabria</a></span></span>
        
      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    
    <div class="read-more">
      
        <div class="read-more-header">
          <a href="http://linuxdynasty.github.io/Linuxdynasty/how-to-install-the-data-protector-6-linux-install-server-on-linux/" class="read-more-btn">Read More</a>
        </div><!-- /.read-more-header -->
        <div class="read-more-content">
          <h3><a href="http://linuxdynasty.github.io/Linuxdynasty/blog/years-silence/" title="Two years of silence">Two years of silence</a></h3>
          <p>I have been so focused on vFense, that I have been negligent of this blog.vFense has come a long way from it's inception a little over 20...&hellip; <a href="http://linuxdynasty.github.io/Linuxdynasty/blog/years-silence/">Continue reading</a></p>
        </div><!-- /.read-more-content -->
      
      <div class="read-more-list">
        
          <div class="list-item">
            <h4><a href="http://linuxdynasty.github.io/Linuxdynasty/python/zenoss/redis/howto-check-redis-availability-stats-redis-py-zenoss-python/" title="HowTo check redis availability and get stats using Redis-py, Zenoss, and Python">HowTo check redis availability and get stats using Redis-py, Zenoss, and Python</a></h4>
            <span>Published on March 20, 2012</span>
          </div><!-- /.list-item -->
        
          <div class="list-item">
            <h4><a href="http://linuxdynasty.github.io/Linuxdynasty/python/zenoss/monitor-rtsp-streaming-videos-openrtsp-zenoss/" title="How To monitor RTSP streaming videos using openRTSP and Zenoss">How To monitor RTSP streaming videos using openRTSP and Zenoss</a></h4>
            <span>Published on December 30, 2011</span>
          </div><!-- /.list-item -->
        
      </div><!-- /.read-more-list -->
      
    </div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2014 Allen Sanabria. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://linuxdynasty.github.io/Linuxdynasty/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://linuxdynasty.github.io/Linuxdynasty/assets/js/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2333243-1', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'linuxdynasty'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>	        

</body>
</html>
